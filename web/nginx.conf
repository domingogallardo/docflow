include /etc/nginx/modules/*.conf;

user nginx;

worker_processes 1;

events {
    worker_connections 1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    server {
        listen 80;
        server_name localhost;

        root /usr/share/nginx/html;

        # --- NEW: host-mounted data ---
        location /data/ {
            alias /data/;
            add_header Cache-Control "no-cache, no-store, must-revalidate" always;

            # Optional listing (remove if you do not want it)
            autoindex on;

            # WebDAV: allow only PUT (no DELETE, no MKCOL)
            # Requires ngx_http_dav_module
            create_full_put_path on;
            dav_methods PUT;
            dav_access user:rw group:r all:r;

            # Allow reads without credentials, but require auth for write methods
            limit_except GET HEAD {
                auth_basic "Protected editing";
                auth_basic_user_file /etc/nginx/.htpasswd;
            }
        }
        

        # /read (new): combined HTML + downloaded PDFs
        location = /read {
            return 301 /read/;
        }
        location /read/ {
            alias /usr/share/nginx/html/read/;
            index read.html;
            try_files $uri $uri/ /read/read.html;
            autoindex off;
        }

        # /papers: own PDFs (managed outside the repo)
        location = /papers {
            return 301 /papers/;
        }
        location /papers/ {
            alias /usr/share/nginx/html/papers/;
            index index.html;
            try_files $uri $uri/ /papers/index.html;
        }
        
        # Serve any other static folder or file
        location / {
            try_files $uri $uri/ =404;
        }

        add_header X-Content-Type-Options nosniff;
        add_header X-Frame-Options DENY;
    }
}
