include /etc/nginx/modules/*.conf;

worker_processes 1;

events {
    worker_connections 1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    server {
        listen 80;
        server_name localhost;

        root /usr/share/nginx/html;

        # --- NUEVO: editor, página estática ---
        location = /editor {
            try_files /editor.html =404;   # sirve public/editor.html
        }

        # --- NUEVO: datos montados del host ---
        location /data/ {
            alias /data/;

            # Listado opcional (si no lo quieres, bórralo)
            autoindex on;

            # WebDAV: permitir solo PUT (no DELETE, no MKCOL)
            # Requiere módulo ngx_http_dav_module
            create_full_put_path on;
            dav_methods PUT;
            dav_access user:rw group:r all:r;

            # Permitir lectura sin credenciales, pero exigir auth en métodos de escritura
            limit_except GET HEAD {
                auth_basic "Edición protegida";
                auth_basic_user_file /etc/nginx/.htpasswd;
            }
        }
        
        location = /docs {
            return 301 /docs/;
        }

        # /docs: índice estático
        location /docs/ {
            alias /usr/share/nginx/html/docs/;
            index index.html;
            try_files $uri $uri/ /docs/index.html;
        }

        location = /posts {
            return 301 /posts/;
        }

        # /posts: índice estático generado en deploy
        location /posts/ {
            alias /usr/share/nginx/html/posts/;
            index index.html;
            try_files $uri $uri/ /posts/index.html;
        }

        # Servir cualquier otra carpeta o archivo estático
        location / {
            try_files $uri $uri/ =404;
        }

        add_header X-Content-Type-Options nosniff;
        add_header X-Frame-Options DENY;
    }
}
