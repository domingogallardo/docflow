include /etc/nginx/modules/*.conf;

user nginx;

worker_processes 1;

events {
    worker_connections 1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    server {
        listen 80;
        server_name localhost;

        root /usr/share/nginx/html;

        # --- NUEVO: editor, página estática ---
        location = /editor {
            try_files /editor.html =404;   # sirve public/editor.html
        }

        # --- NUEVO: datos montados del host ---
        location /data/ {
            alias /data/;

            # Listado opcional (si no lo quieres, bórralo)
            autoindex on;

            # WebDAV: permitir solo PUT (no DELETE, no MKCOL)
            # Requiere módulo ngx_http_dav_module
            create_full_put_path on;
            dav_methods PUT;
            dav_access user:rw group:r all:r;

            # Permitir lectura sin credenciales, pero exigir auth en métodos de escritura
            limit_except GET HEAD {
                auth_basic "Edición protegida";
                auth_basic_user_file /etc/nginx/.htpasswd;
            }
        }
        

        # /read (nuevo): combinados HTML + PDF descargados
        location = /read {
            return 301 /read/;
        }
        location /read/ {
            alias /usr/share/nginx/html/read/;
            index index.html;
            try_files $uri $uri/ /read/index.html;
        }

        # /papers: PDFs propios (gestionado fuera del repo)
        location = /papers {
            return 301 /papers/;
        }
        location /papers/ {
            alias /usr/share/nginx/html/papers/;
            index index.html;
            try_files $uri $uri/ /papers/index.html;
        }

        

        # Servir cualquier otra carpeta o archivo estático
        location / {
            try_files $uri $uri/ =404;
        }

        add_header X-Content-Type-Options nosniff;
        add_header X-Frame-Options DENY;
    }
}
