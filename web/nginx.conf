include /etc/nginx/modules/*.conf;

worker_processes 1;

events {
    worker_connections 1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    server {
        listen 80;
        server_name localhost;

        root /usr/share/nginx/html;

        # --- NUEVO: editor, página estática ---
        location = /editor {
            try_files /editor.html =404;   # sirve public/editor.html
        }

        # --- NUEVO: datos montados del host ---
        location /data/ {
            alias /data/;

            # Listado opcional (si no lo quieres, bórralo)
            autoindex on;

            # WebDAV: permitir solo PUT (no DELETE, no MKCOL)
            # Requiere módulo ngx_http_dav_module
            create_full_put_path on;
            dav_methods PUT;
            dav_access user:rw group:r all:r;

            # Permitir lectura sin credenciales, pero exigir auth en métodos de escritura
            limit_except GET HEAD {
                auth_basic "Edición protegida";
                auth_basic_user_file /etc/nginx/.htpasswd;
            }
        }
        
        location = /docs {
            return 301 /docs/;
        }

        location /docs/ {
            alias /usr/share/nginx/html/docs/;

            fancyindex on;                     # activa listado "fancy"
            fancyindex_default_sort date_desc; # ordenar por mtime (lo más reciente arriba)
            fancyindex_directories_first off;  # mezcla carpetas y archivos por fecha
            fancyindex_exact_size off;         # tamaños legibles
            fancyindex_localtime on;           # usa TZ del contenedor (ver Dockerfile)

            try_files $uri $uri/ =404;
        }

        location /posts/ {
            alias /usr/share/nginx/html/posts/;
            fancyindex on;
            fancyindex_default_sort date_desc;
            fancyindex_directories_first off;
            fancyindex_exact_size off;
            fancyindex_localtime on;
        }

        # Servir cualquier otra carpeta o archivo estático
        location / {
            try_files $uri $uri/ =404;
        }

        add_header X-Content-Type-Options nosniff;
        add_header X-Frame-Options DENY;
    }
}